<div class="container">
  <div class="subject-form-wrapper">
    <!-- Header Section -->
    <div class="form-header">
      <div class="header-content">
        <h1>
          <span class="icon">üìö</span>
          {{ isEdit ? 'Edit Subject' : 'Create New Subject' }}
        </h1>
        <p class="subtitle">{{ isEdit ? 'Update subject information and settings' : 'Add a new subject to the system' }}</p>
      </div>
      <button class="btn btn-icon" (click)="router.navigate(['/subjects'])" title="Back to Subjects">
        ‚Üê Back
      </button>
    </div>

    <!-- Alert Messages -->
    <div class="alert alert-success" *ngIf="success" [@fadeInOut]>
      <span class="alert-icon">‚úì</span>
      <span>{{ success }}</span>
    </div>
    <div class="alert alert-error" *ngIf="error" [@fadeInOut]>
      <span class="alert-icon">‚úï</span>
      <span>{{ error }}</span>
    </div>

    <!-- Form Container -->
    <div class="form-container">
      <form (ngSubmit)="onSubmit()" #subjectForm="ngForm">
        <!-- Basic Information Section -->
        <div class="form-section">
          <div class="section-header">
            <h2>
              <span class="section-icon">üìã</span>
              Basic Information
            </h2>
            <p class="section-description">Enter the essential details for this subject</p>
          </div>

          <div class="form-grid">
            <!-- Subject Name -->
            <div class="form-group" [class.has-error]="isFieldInvalid('name')">
              <label for="name">
                Subject Name <span class="required">*</span>
                <span class="field-hint">e.g., Mathematics, English, Science</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  id="name"
                  [(ngModel)]="subject.name" 
                  name="name" 
                  required
                  [class.invalid]="isFieldInvalid('name')"
                  placeholder="Enter subject name"
                  (blur)="validateField('name')"
                  (input)="onFieldChange('name')"
                  maxlength="100"
                  autocomplete="off">
                <span class="char-counter" *ngIf="subject.name">{{ subject.name.length }}/100</span>
              </div>
              <div class="field-error" *ngIf="isFieldInvalid('name')">
                {{ getFieldError('name') }}
              </div>
            </div>

            <!-- Subject Code -->
            <div class="form-group" [class.has-error]="isFieldInvalid('code')">
              <label for="code">
                Subject Code <span class="required">*</span>
                <span class="field-hint">e.g., MATH, ENG, SCI (will be converted to uppercase)</span>
              </label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  id="code"
                  [(ngModel)]="subject.code" 
                  name="code" 
                  required
                  [class.invalid]="isFieldInvalid('code')"
                  placeholder="Enter subject code"
                  (blur)="validateField('code')"
                  (input)="onCodeChange()"
                  maxlength="20"
                  autocomplete="off"
                  style="text-transform: uppercase;">
                <span class="char-counter" *ngIf="subject.code">{{ subject.code.length }}/20</span>
              </div>
              <div class="field-hint">
                <span class="hint-icon">üí°</span>
                Unique code for the subject (e.g., MATH, ENG, SCI)
              </div>
              <div class="field-error" *ngIf="isFieldInvalid('code')">
                {{ getFieldError('code') }}
              </div>
            </div>
          </div>

          <!-- Description -->
          <div class="form-group full-width" [class.has-error]="isFieldInvalid('description')">
            <label for="description">
              Description
              <span class="field-hint">Optional: Add additional information about this subject</span>
            </label>
            <div class="textarea-wrapper">
              <textarea 
                id="description"
                [(ngModel)]="subject.description" 
                name="description" 
                rows="4"
                [class.invalid]="isFieldInvalid('description')"
                placeholder="Enter subject description (optional)"
                (blur)="validateField('description')"
                (input)="onFieldChange('description')"
                maxlength="500"></textarea>
              <span class="char-counter" *ngIf="subject.description">{{ subject.description.length }}/500</span>
            </div>
            <div class="field-error" *ngIf="isFieldInvalid('description')">
              {{ getFieldError('description') }}
            </div>
          </div>
        </div>

        <!-- Additional Settings Section -->
        <div class="form-section" *ngIf="isEdit">
          <div class="section-header">
            <h2>
              <span class="section-icon">‚öôÔ∏è</span>
              Settings
            </h2>
            <p class="section-description">Manage subject status and availability</p>
          </div>

          <div class="form-group full-width">
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="isActive"
                [(ngModel)]="subject.isActive" 
                name="isActive"
                class="toggle-input">
              <label for="isActive" class="toggle-label">
                <span class="toggle-slider"></span>
                <span class="toggle-text">
                  <strong>Active Subject</strong>
                  <small>Inactive subjects won't appear in exam and class assignment options</small>
                </span>
              </label>
            </div>
          </div>
        </div>

        <!-- Preview Section -->
        <div class="form-section preview-section" *ngIf="subject.name || subject.code">
          <div class="section-header">
            <h2>
              <span class="section-icon">üëÅÔ∏è</span>
              Preview
            </h2>
            <p class="section-description">Preview of your subject information</p>
          </div>
          <div class="preview-card">
            <div class="preview-item">
              <span class="preview-label">Subject Name:</span>
              <span class="preview-value">{{ subject.name || 'Not set' }}</span>
            </div>
            <div class="preview-item">
              <span class="preview-label">Subject Code:</span>
              <span class="preview-value code-badge">{{ subject.code || 'Not set' }}</span>
            </div>
            <div class="preview-item" *ngIf="subject.description">
              <span class="preview-label">Description:</span>
              <span class="preview-value">{{ subject.description }}</span>
            </div>
            <div class="preview-item" *ngIf="isEdit">
              <span class="preview-label">Status:</span>
              <span class="preview-value" [class.active]="subject.isActive" [class.inactive]="!subject.isActive">
                {{ subject.isActive ? 'Active' : 'Inactive' }}
              </span>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button 
            type="button" 
            class="btn btn-secondary" 
            (click)="router.navigate(['/subjects'])"
            [disabled]="submitting">
            ‚ùå Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-primary btn-submit"
            [disabled]="submitting || !isFormValid()">
            <span *ngIf="!submitting">
              {{ isEdit ? 'üíæ Update Subject' : '‚ûï Create Subject' }}
            </span>
            <span *ngIf="submitting" class="submit-loading">
              <span class="spinner-small"></span>
              {{ isEdit ? 'Updating...' : 'Creating...' }}
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
