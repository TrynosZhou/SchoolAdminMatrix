<div class="dashboard-container">
  <!-- Main Content -->
    <main class="main-content">
      <div class="content-header">
        <div class="header-top">
          <div class="header-left">
            <div class="greeting-section">
              <h1 class="dashboard-title">
                <span class="title-icon">ğŸ“Š</span>
                Dashboard
              </h1>
              <p class="welcome-text">
                <span class="greeting-icon">ğŸ‘‹</span>
                Welcome back, <strong>{{ user?.email }}</strong>!
              </p>
              <p class="date-time">{{ getCurrentDateTime() }}</p>
            </div>
          </div>
          <div class="header-right">
            <div class="school-name-container" *ngIf="displayedText">
              <span class="school-icon">ğŸ«</span>
              <span class="school-name" [class.school-motto-text]="displayedText === schoolMotto">{{ displayedText }}</span>
            </div>
            <div class="quick-stats-badge" *ngIf="(isAdmin() || isAccountant()) && !loadingStats">
              <span class="badge-icon">âš¡</span>
              <span class="badge-text">Live Stats</span>
            </div>
          </div>
        </div>
      </div>
    
    <!-- Statistics Cards -->
    <div class="stats-grid" *ngIf="(isAdmin() || isAccountant()) && !loadingStats">
      <div class="stat-card primary modern-card">
        <div class="stat-icon-wrapper">
          <div class="stat-icon modern-icon">ğŸ‘¥</div>
          <div class="icon-badge">+</div>
        </div>
        <div class="stat-content">
          <div class="stat-value animated-value">{{ stats.totalStudents }}</div>
          <div class="stat-label">Total Students</div>
          <div class="stat-sublabel" *ngIf="stats.totalStudents > 0">
            <span class="sublabel-item">ğŸ“˜ {{ stats.dayScholars }} Day Scholars</span>
            <span class="sublabel-item">ğŸ  {{ stats.boarders }} Boarders</span>
          </div>
        </div>
        <div class="stat-trend up">
          <span class="trend-icon">ğŸ“ˆ</span>
        </div>
      </div>
      
      <div class="stat-card success modern-card">
        <div class="stat-icon-wrapper">
          <div class="stat-icon modern-icon">ğŸ‘¨â€ğŸ«</div>
        </div>
        <div class="stat-content">
          <div class="stat-value animated-value">{{ stats.totalTeachers }}</div>
          <div class="stat-label">Teachers</div>
          <div class="stat-sublabel">
            <span class="sublabel-item">Active Staff</span>
          </div>
        </div>
        <div class="stat-trend">
          <span class="trend-icon">âœ¨</span>
        </div>
      </div>
      
      <div class="stat-card info modern-card">
        <div class="stat-icon-wrapper">
          <div class="stat-icon modern-icon">ğŸ«</div>
        </div>
        <div class="stat-content">
          <div class="stat-value animated-value">{{ stats.totalClasses }}</div>
          <div class="stat-label">Active Classes</div>
          <div class="stat-sublabel">
            <span class="sublabel-item">Currently Running</span>
          </div>
        </div>
        <div class="stat-trend">
          <span class="trend-icon">ğŸ“</span>
        </div>
      </div>
      
      <div class="stat-card warning modern-card">
        <div class="stat-icon-wrapper">
          <div class="stat-icon modern-icon">ğŸ“š</div>
        </div>
        <div class="stat-content">
          <div class="stat-value animated-value">{{ stats.totalSubjects }}</div>
          <div class="stat-label">Subjects</div>
          <div class="stat-sublabel">
            <span class="sublabel-item">Available Courses</span>
          </div>
        </div>
        <div class="stat-trend">
          <span class="trend-icon">ğŸ“–</span>
        </div>
      </div>
      
      <div class="stat-card danger modern-card" *ngIf="isAdmin() || isAccountant()">
        <div class="stat-icon-wrapper">
          <div class="stat-icon modern-icon">ğŸ’°</div>
        </div>
        <div class="stat-content">
          <div class="stat-value animated-value">{{ stats.totalInvoices }}</div>
          <div class="stat-label">Total Invoices</div>
          <div class="stat-sublabel" *ngIf="stats.totalBalance > 0">
            <span class="sublabel-item warning-text">âš ï¸ Outstanding: {{ stats.totalBalance | number:'1.2-2' }}</span>
          </div>
        </div>
        <div class="stat-trend">
          <span class="trend-icon">ğŸ’³</span>
        </div>
      </div>
      
      <div class="stat-card secondary modern-card" *ngIf="isAdmin()">
        <div class="stat-icon-wrapper">
          <div class="stat-icon modern-icon">ğŸ‘¶</div>
        </div>
        <div class="stat-content">
          <div class="stat-value animated-value">{{ stats.staffChildren }}</div>
          <div class="stat-label">Staff Children</div>
          <div class="stat-sublabel">
            <span class="sublabel-item">Special Category</span>
          </div>
        </div>
        <div class="stat-trend">
          <span class="trend-icon">â­</span>
        </div>
      </div>
    </div>
    
    <div class="loading-stats" *ngIf="(isAdmin() || isAccountant()) && loadingStats">
      <div class="spinner"></div>
      <p>Loading statistics...</p>
    </div>
    
    <div class="dashboard-cards">
      <div class="card modern-card">
        <div class="card-header-modern">
          <h2>
            <span class="card-icon">âš¡</span>
            Quick Overview
          </h2>
        </div>
        <div *ngIf="isAdmin()">
          <h3>Admin Features</h3>
          <ul>
            <li>âœ… Manage Students - Register and enroll students</li>
            <li>âœ… Manage Teachers - Add and assign teachers</li>
            <li>âœ… Manage Exams - Create and organize exams</li>
            <li>âœ… Mark Attendance - Record daily student attendance</li>
            <li>âœ… Attendance Reports - View class attendance statistics</li>
            <li>âœ… Manage Finance - Handle invoices and payments</li>
            <li>âœ… View Report Cards - Access all student reports</li>
            <li>âœ… View Rankings - See class and form rankings</li>
          </ul>
        </div>
        <div *ngIf="isTeacher()">
          <h3>Teacher Features</h3>
          <ul>
            <li>âœ… Capture Marks - Enter student exam marks</li>
            <li>âœ… Mark Attendance - Record daily student attendance</li>
            <li>âœ… Attendance Reports - View class attendance statistics</li>
            <li>âœ… View Rankings - Check class and subject rankings</li>
            <li>âœ… View Report Cards - Generate student reports</li>
          </ul>
        </div>
        <div *ngIf="isAccountant()">
          <h3>Accountant Features</h3>
          <ul>
            <li>âœ… Manage Finance - Create and track invoices and payments</li>
            <li>âœ… View Students - Access student directory for billing updates</li>
            <li>âœ… Monitor Balances - Review outstanding balances and payment history</li>
          </ul>
        </div>
        <div *ngIf="isParent()">
          <h3>Parent Features</h3>
          <ul>
            <li>âœ… Link Students - Connect your account to your child's profile</li>
            <li>âœ… View Invoice Balance - Check your child's current invoice balance</li>
            <li>âœ… View Report Cards - Access your child's report cards (when balance is cleared)</li>
          </ul>
          <p style="margin-top: 15px;">
            <a routerLink="/parent/dashboard" class="action-btn" style="text-decoration: none; display: inline-block;">
              Go to Parent Dashboard â†’
            </a>
          </p>
        </div>
      </div>

      <div class="card modern-card" *ngIf="isAdmin() || isAccountant()">
        <div class="card-header-modern">
          <h2>
            <span class="card-icon">ğŸš€</span>
            Quick Actions
          </h2>
        </div>
        <div class="quick-actions modern-actions">
          <a routerLink="/students/new" class="action-btn modern-action-btn primary-action" *ngIf="isAdmin()">
            <span class="action-icon">ğŸ‘¤</span>
            <span class="action-text">Add Student</span>
            <span class="action-arrow">â†’</span>
          </a>
          <a routerLink="/classes/new" class="action-btn modern-action-btn info-action" *ngIf="isAdmin()">
            <span class="action-icon">ğŸ«</span>
            <span class="action-text">Add Class</span>
            <span class="action-arrow">â†’</span>
          </a>
          <a routerLink="/subjects/new" class="action-btn modern-action-btn warning-action" *ngIf="isAdmin()">
            <span class="action-icon">ğŸ“š</span>
            <span class="action-text">Add Subject</span>
            <span class="action-arrow">â†’</span>
          </a>
          <a routerLink="/teachers/new" class="action-btn modern-action-btn success-action" *ngIf="isAdmin()">
            <span class="action-icon">ğŸ‘¨â€ğŸ«</span>
            <span class="action-text">Add Teacher</span>
            <span class="action-arrow">â†’</span>
          </a>
          <a (click)="openBulkMessage()" class="action-btn modern-action-btn secondary-action" style="cursor: pointer;" *ngIf="isAdmin()">
            <span class="action-icon">ğŸ“§</span>
            <span class="action-text">Bulk Message</span>
            <span class="action-arrow">â†’</span>
          </a>
          <a routerLink="/attendance/mark" class="action-btn modern-action-btn success-action" *ngIf="isAdmin() || isTeacher()">
            <span class="action-icon">âœ…</span>
            <span class="action-text">Mark Attendance</span>
            <span class="action-arrow">â†’</span>
          </a>
          <a routerLink="/attendance/reports" class="action-btn modern-action-btn info-action" *ngIf="isAdmin() || isTeacher()">
            <span class="action-icon">ğŸ“Š</span>
            <span class="action-text">Attendance Reports</span>
            <span class="action-arrow">â†’</span>
          </a>
          <a routerLink="/students" class="action-btn modern-action-btn primary-action" *ngIf="isAccountant()">
            <span class="action-icon">ğŸ“‹</span>
            <span class="action-text">View Students</span>
            <span class="action-arrow">â†’</span>
          </a>
          <a routerLink="/invoices" class="action-btn modern-action-btn danger-action" *ngIf="isAccountant()">
            <span class="action-icon">ğŸ’°</span>
            <span class="action-text">Finance Overview</span>
            <span class="action-arrow">â†’</span>
          </a>
          <a routerLink="/invoices/new" class="action-btn modern-action-btn danger-action" *ngIf="isAdmin() || isAccountant()">
            <span class="action-icon">ğŸ“</span>
            <span class="action-text">Create Invoice</span>
            <span class="action-arrow">â†’</span>
          </a>
          <a routerLink="/admin/manage-accounts" class="action-btn modern-action-btn secondary-action" *ngIf="isAdmin()">
            <span class="action-icon">ğŸ‘¥</span>
            <span class="action-text">Manage Accounts</span>
            <span class="action-arrow">â†’</span>
          </a>
          <a routerLink="/admin/class-promotion" class="action-btn modern-action-btn warning-action" *ngIf="isAdmin()">
            <span class="action-icon">â¬†ï¸</span>
            <span class="action-text">Class Promotion</span>
            <span class="action-arrow">â†’</span>
          </a>
        </div>
      </div>
      
      <!-- Recent Activity Section -->
      <div class="card recent-activity modern-card" *ngIf="(isAdmin() || isAccountant()) && !loadingStats">
        <div class="card-header-flex">
          <h2>
            <span class="card-icon">ğŸ•’</span>
            Recent Activity
          </h2>
          <a routerLink="/students" class="view-all-link modern-link" *ngIf="recentStudents.length > 0">
            View All 
            <span class="link-arrow">â†’</span>
          </a>
        </div>
        
        <div class="activity-tabs">
          <div class="tab-content">
            <h3 class="tab-title">Recent Students</h3>
            <div class="activity-list" *ngIf="recentStudents.length > 0; else noRecentStudents">
              <div class="activity-item modern-activity-item" *ngFor="let student of recentStudents">
                <div class="activity-icon-wrapper">
                  <div class="activity-icon modern-activity-icon">ğŸ‘¤</div>
                </div>
                <div class="activity-details">
                  <div class="activity-name">{{ student.firstName }} {{ student.lastName }}</div>
                  <div class="activity-meta">
                    <span class="meta-badge">ğŸ†” {{ student.studentNumber }}</span>
                    <span class="meta-badge" *ngIf="student.class">ğŸ« {{ student.class.name }}</span>
                    <span class="meta-badge">{{ student.studentType || 'Day Scholar' }}</span>
                  </div>
                </div>
                <div class="activity-action">
                  <a [routerLink]="['/students', student.id, 'edit']" class="btn-link modern-btn-link">
                    <span>âœï¸</span> Edit
                  </a>
                </div>
              </div>
            </div>
            <ng-template #noRecentStudents>
              <div class="empty-state">
                <p>No recent students</p>
              </div>
            </ng-template>
          </div>
          
          <div class="tab-content" *ngIf="isAdmin() || isAccountant()">
            <h3 class="tab-title">Recent Invoices</h3>
            <div class="activity-list" *ngIf="recentInvoices.length > 0; else noRecentInvoices">
              <div class="activity-item modern-activity-item" *ngFor="let invoice of recentInvoices">
                <div class="activity-icon-wrapper">
                  <div class="activity-icon modern-activity-icon invoice-icon">ğŸ’°</div>
                </div>
                <div class="activity-details">
                  <div class="activity-name">Invoice #{{ invoice.invoiceNumber }}</div>
                  <div class="activity-meta">
                    <span class="meta-badge" [class.balance-warning]="invoice.balance > 0">
                      ğŸ’µ Balance: {{ invoice.balance | number:'1.2-2' }}
                    </span>
                    <span class="meta-badge" *ngIf="invoice.student">
                      ğŸ‘¤ {{ invoice.student.firstName }} {{ invoice.student.lastName }}
                    </span>
                  </div>
                </div>
                <div class="activity-action">
                  <a [routerLink]="['/invoices']" class="btn-link modern-btn-link">
                    <span>ğŸ‘ï¸</span> View
                  </a>
                </div>
              </div>
            </div>
            <ng-template #noRecentInvoices>
              <div class="empty-state">
                <p>No recent invoices</p>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Bulk Message Modal -->
  <app-bulk-message *ngIf="showBulkMessage" (close)="closeBulkMessage()"></app-bulk-message>
</div>

